@require(data)
/**
 * \file
 * \copyright (c) Copyright 2024-2025 Zenseact AB
 * \license SPDX-License-Identifier: Apache-2.0
 *
 * \details Autogenerated file - do not change!
 *
 * app: @appname
 * template: @template
 *
 * How to update:
 * 1. Update the template
 * 2. Run `python -m codegen` in the project root
 * 3. Commit changes
 */


#include "zmbt/expr/expression.hpp"
#include "zmbt/expr/eval_impl.hpp"

namespace zmbt {
namespace lang {

@for keyword in data.ApiKeywords:
extern template Expression dispatch_eval<Keyword::@keyword.Name>(Expression const&, Expression const&, EvalContext);
@end


boost::json::value Expression::eval(Expression const& x, EvalContext ctx) const
{
    return eval_e(x, ctx).to_json();
}

boost::json::value Expression::eval(Expression& x) const
{
    return eval(x, {});
}

Expression Expression::eval_e(Expression const& x, EvalContext context) const
try
{

    switch (keyword())
    {
        case Keyword::Literal: return *this;
@for keyword in data.ApiKeywords:
        case Keyword::@keyword.Name: return dispatch_eval<Keyword::@keyword.Name>(*this, x, context);
@end
        default:
            return nullptr; // TODO: err
    }
}
catch(const std::exception& e)
{
    return detail::make_error_expr(e.what(), keyword_to_str());
}

} // namespace expr
} // namespace zmbt
