
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../expressions/">
      
      
      <link rel="icon" href="../../images/zenseact-logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Signal Mapping Model - Zenseact MBT Framework</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/mkdocs_puml/puml.css">
    
      <link rel="stylesheet" href="../../assets/mkdocs_puml/interaction.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#signal-mapping-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Zenseact MBT Framework" class="md-header__button md-logo" aria-label="Zenseact MBT Framework" data-md-component="logo">
      
  <img src="../../images/zenseact-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zenseact MBT Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Signal Mapping Model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zenseact/zmbt-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Zenseact MBT Framework" class="md-nav__button md-logo" aria-label="Zenseact MBT Framework" data-md-component="logo">
      
  <img src="../../images/zenseact-logo.svg" alt="logo">

    </a>
    Zenseact MBT Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zenseact/zmbt-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Signal Mapping Model
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Signal Mapping Model
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-example" class="md-nav__link">
    <span class="md-ellipsis">
      Minimal Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Structure Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes-and-channels" class="md-nav__link">
    <span class="md-ellipsis">
      Pipes and Channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Test Conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-inline-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      1. Inline Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tabular-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Tabular Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mixed-mode" class="md-nav__link">
    <span class="md-ellipsis">
      3. Mixed Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      Test Procedure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Input generators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input generators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Order matters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-matchers" class="md-nav__link">
    <span class="md-ellipsis">
      Output matchers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output matchers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#series-vs-atomic-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Series vs atomic samples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Serialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON Serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-pointer" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Pointer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametrized-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrized Paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator-overloading" class="md-nav__link">
    <span class="md-ellipsis">
      Operator overloading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocks" class="md-nav__link">
    <span class="md-ellipsis">
      Mocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametrization" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parametrization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-non-serializable-components" class="md-nav__link">
    <span class="md-ellipsis">
      Registering non-serializable components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-channels-in-pipes" class="md-nav__link">
    <span class="md-ellipsis">
      Combining channels in pipes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixture-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Fixture tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-output" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expressions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expressions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reflection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reflection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Framework Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DSL Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DSL Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dsl-reference/signal-mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Signal mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dsl-reference/expressions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expressions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    C++ API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            C++ API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Namespaces
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Namespaces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace List
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespace_members/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespace_member_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Member Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespace_member_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Member Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespace_member_typedefs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Member Typedefs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/namespace_member_enums/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace Member Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/annotated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class List
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/hierarchy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Hierarchy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/class_members/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/class_member_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Member Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/class_member_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Member Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/class_member_typedefs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Member Typedefs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/class_member_enums/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Member Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/macros/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Macros
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CxxRef/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Files
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-example" class="md-nav__link">
    <span class="md-ellipsis">
      Minimal Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Structure Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes-and-channels" class="md-nav__link">
    <span class="md-ellipsis">
      Pipes and Channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Test Conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-inline-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      1. Inline Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tabular-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Tabular Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mixed-mode" class="md-nav__link">
    <span class="md-ellipsis">
      3. Mixed Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      Test Procedure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Input generators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input generators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Order matters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-matchers" class="md-nav__link">
    <span class="md-ellipsis">
      Output matchers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output matchers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#series-vs-atomic-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Series vs atomic samples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Serialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON Serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-pointer" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Pointer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametrized-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrized Paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator-overloading" class="md-nav__link">
    <span class="md-ellipsis">
      Operator overloading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocks" class="md-nav__link">
    <span class="md-ellipsis">
      Mocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametrization" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parametrization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-non-serializable-components" class="md-nav__link">
    <span class="md-ellipsis">
      Registering non-serializable components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-channels-in-pipes" class="md-nav__link">
    <span class="md-ellipsis">
      Combining channels in pipes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixture-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Fixture tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-output" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostic output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<!-- (c) Copyright 2024 Zenseact AB -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<h1 id="signal-mapping-model">Signal Mapping model<a class="headerlink" href="#signal-mapping-model" title="Permanent link">&para;</a></h1>
<p><strong>Signal Mapping</strong> models the interaction with the system under test (SUT) as a trace-level mapping
from generated input sequences to observable outputs, evaluated via matchers.
While the SUT may retain internal state or side effects, the test model abstracts it as a function over time,
capturing only what is exposed through interfaces.</p>
<p>Instead of embedding logic in procedural test code, the framework defines inputs, outputs,
and expectations as condition pipes — structured, composable expressions tied to interface contracts.
It shifts focus from “what happens when” to “what is observed where”, utilizing powerful and expressive
generators and matchers, and structural introspection of the test model.</p>
<p>Its embedded DSL enforces valid composition rules and eliminates ambiguity, guiding users toward correct-by-construction
test designs and making misconfigurations easier to catch — often at compile time.</p>
<p>The following guide illustrates the model DSL using code examples from
<a href="../../examples/cxx/signal-mapping-demo.cpp">examples/cxx/signal-mapping-demo.cpp</a>.
For complete documentation, refer to the <a href="../../dsl-reference/signal-mapping/">Signal Mapping DSL Reference</a>.</p>
<h2 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><em>C++ 14</em> or later</li>
<li><em>Boost C++ 1.84</em> or later</li>
</ul>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">  </span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;boost/test/unit_test.hpp&gt;</span><span class="c1"> //(1)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zenseact-mbt.hpp&gt;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">utf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">boost</span><span class="o">::</span><span class="nn">unit_test</span><span class="p">;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">zmbt</span><span class="o">::</span><span class="nn">api</span><span class="p">;</span><span class="w">  </span><span class="c1">(2)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">zmbt</span><span class="o">::</span><span class="nn">expr</span><span class="p">;</span><span class="w"> </span><span class="c1">(3)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">literals</span><span class="o">::</span><span class="nn">chrono_literals</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li>These examples use Boost.Test as a host framework, but ZMBT can be embedded into any other. A standalone suite runner is also in development.</li>
<li>Main testing API namespace</li>
<li>Expression Language namespace</li>
</ol>
<h3 id="minimal-example">Minimal Example<a class="headerlink" href="#minimal-example" title="Permanent link">&para;</a></h3>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="o">  </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">QuickExample</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="p">{</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Simple function test&quot;</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Return</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="p">.</span><span class="n">Description</span><span class="p">(</span><span class="s">&quot;inject x and y and check returning sum&quot;</span><span class="p">)</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="p">}</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="cm">  </span>
</span></code></pre></div>
<p>This example defines a basic signal mapping model with two inputs and one output.</p>
<ul>
<li><code>OnTrigger(sum)</code> defines the entry point: the function under test.</li>
<li><code>At(sum).Args(n).Inject()</code> maps inputs by position in the argument tuple.</li>
<li><code>At(sum).Return().Expect()</code> defines the expected output to observe.</li>
</ul>
<p>The <code>.Test(...)</code> clause defines list of test vectors using chained operator() calls.
Each column corresponds 1:1 with an input or output channel defined in the pipe configuration above.</p>
<p>In this case, the runner:</p>
<ol>
<li>Takes the first two values as inputs to sum</li>
<li>Calls <code>sum(x, y)</code></li>
<li>Checks whether the result matches the third value</li>
</ol>
<p>The Test clause defines a list of test vectors using cascade of <code>operator()</code> calls,
where each line represents one test case.
The <code>At(sum)...</code> lines form a list of signal pipes, which can be viewed as headers
for the corresponding columns in the test matrix. The channel-to-column indexation
is 1-to-1 for pipes with empty <code>Inject()</code> or <code>Expect()</code> clauses;</p>
<p>For each test case, the runner invokes <code>sum</code> with the first two values as inputs
and checks whether the result matches the third value.</p>
<p>The same test can be expressed with a single channel for both input arguments:
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="o">  </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">NonScalarValues</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Simple test with non-scalar input&quot;</span><span class="p">)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">   </span><span class="mi">2</span><span class="p">},</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">-2</span><span class="p">},</span><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">},</span><span class="w"> </span><span class="mf">42.1</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">}</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="cm">  </span>
</span></code></pre></div></p>
<p>Following the default configuration rules, <code>.At(sum).Inject()</code> is equivalent to <code>.At(sum).Args("").Inject()</code>
for non-unary triggers. This means the entire argument tuple is treated as a JSON array and passed as a single value.</p>
<h2 id="basic-concepts">Basic Concepts<a class="headerlink" href="#basic-concepts" title="Permanent link">&para;</a></h2>
<h3 id="structure-overview">Structure Overview<a class="headerlink" href="#structure-overview" title="Permanent link">&para;</a></h3>
<p><strong>Signal Mapping</strong> tests are defined declaratively using a <strong>Domain-Specific Language (DSL)</strong> embedded in C++.
Each test case specifies how the system under test (SUT) is exercised and observed using the following elements:</p>
<ul>
<li><a href="../../dsl-reference/signal-mapping/#clauses"><strong>Clauses</strong></a> — chained method calls that define test configuration.</li>
<li><strong>Trigger</strong> — the interface that initiates test execution.</li>
<li><strong>Test Conditions</strong> — input generators and output matchers.</li>
<li><strong>Channels</strong> — individual signal selectors associated with interface.</li>
<li><strong>Condition Pipes</strong> — combinations of channels that share a test condition.</li>
</ul>
<h3 id="pipes-and-channels">Pipes and Channels<a class="headerlink" href="#pipes-and-channels" title="Permanent link">&para;</a></h3>
<ul>
<li>A <strong>channel</strong> represents a specific interface point (e.g., function input, return, or exception) with optional filters.</li>
<li>A <strong>pipe</strong> is a group of one or more channels that share the same condition.</li>
<li>Channels can be grouped into pipes using <code>.Group()</code> or <code>.Blend()</code> to express different composition logic (see below).</li>
</ul>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// One-channel pipe</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1">// Multi-channel pipe</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Group</span><span class="p">().</span><span class="n">At</span><span class="p">(</span><span class="n">y</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="test-conditions">Test Conditions<a class="headerlink" href="#test-conditions" title="Permanent link">&para;</a></h3>
<p>An <strong>input condition</strong> is a <strong>generating function</strong> — a mapping from the call index to a value.
An <strong>output condition</strong> is a <strong>matcher</strong> — a predicate that maps an observed value to a boolean result.</p>
<p>Literals, constants, and constant expressions are interpreted differently depending on context:</p>
<ul>
<li><strong>Input</strong>: constants are treated as a subset of generators that always return the same value. See <a href="#input-generators">Input generators</a>.</li>
<li><strong>Output</strong>: constants are implicitly converted to equality matchers (<code>Eq(value)</code>).</li>
</ul>
<p>The embedded <a href="#expressions">expression language</a> supports constructing conditions of arbitrary complexity in both input and output contexts.</p>
<p>Test conditions can be specified:</p>
<ul>
<li><strong>Inline</strong>, directly on pipes using <code>.Inject</code> and <code>.Expect*</code> or <code>.Assert*</code> clause parameters, or</li>
<li><strong>Externally</strong>, using the <code>.Test</code> clause to provide tabular test vectors.</li>
</ul>
<h4 id="1-inline-conditions">1. <strong>Inline Conditions</strong><a class="headerlink" href="#1-inline-conditions" title="Permanent link">&para;</a></h4>
<p>Attach expressions directly to the pipe using <code>.Inject</code> or <code>.Expect</code>.</p>
<p><div class="language-c++ highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="o">  </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">InlineConditions</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Inline condition example&quot;</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="c1">(2)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="c1">(3)</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Return</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="n">Each</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">42</span><span class="p">)))</span><span class="w"> </span><span class="c1">(4)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Return</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="n">Slide</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Each</span><span class="p">(</span><span class="n">Lt</span><span class="p">))</span><span class="w"> </span><span class="c1">(5)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="p">}</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="cm">  </span>
</span></code></pre></div>
1. Repeat sum 100 times and apply matchers to an array of collected outputs instead of an atomic value
2. The first argument is fixed to 42.
3. The second input increments per call.
4. Check all outputs are &gt;= 42
5. Check the output is increasing using sliding window matcher</p>
<h4 id="2-tabular-conditions">2. <strong>Tabular Conditions</strong><a class="headerlink" href="#2-tabular-conditions" title="Permanent link">&para;</a></h4>
<p>Leave <code>.Inject()</code> or <code>.Expect()</code> empty, and use <code>.Test</code> to supply values:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="o">  </span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">TabularConditions</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">{</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Tabular condition example&quot;</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Return</span><span class="p">().</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Return</span><span class="p">().</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Each</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">42</span><span class="p">)),</span><span class="w"> </span><span class="n">Slide</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Each</span><span class="p">(</span><span class="n">Lt</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">Mul</span><span class="p">(</span><span class="mi">-1</span><span class="p">),</span><span class="w"> </span><span class="n">Each</span><span class="p">(</span><span class="n">Le</span><span class="p">(</span><span class="mi">13</span><span class="p">)),</span><span class="w"> </span><span class="n">At</span><span class="p">(</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Lt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">      </span><span class="p">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="p">}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="cm">  </span>
</span></code></pre></div>
<p>Each value in a test vector under <code>.Test</code> clause corresponds to one tabular pipe, by the order of declaration.</p>
<h4 id="3-mixed-mode">3. <strong>Mixed Mode</strong><a class="headerlink" href="#3-mixed-mode" title="Permanent link">&para;</a></h4>
<p>Mix inline and tabular pipes in the same test:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">  </span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">MixedConditions</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Mixed condition example&quot;</span><span class="p">)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w">    </span><span class="c1">// Fixed</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span><span class="w">      </span><span class="c1">// Tabular</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sum</span><span class="p">).</span><span class="n">Return</span><span class="p">().</span><span class="n">Expect</span><span class="p">()</span><span class="w">     </span><span class="c1">// Tabular</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">        </span><span class="p">(</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="p">}</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="cm">  </span>
</span></code></pre></div>
<p>Here, <code>.Inject(42)</code> is constant across all test cases, while the second input and output vary per row.</p>
<h3 id="test-procedure">Test Procedure<a class="headerlink" href="#test-procedure" title="Permanent link">&para;</a></h3>
<p>The following procedure is applied to each model instance
obtained from the parameter resolver over each test vector:</p>
<ol>
<li>Reset the environment (drop all input test data).</li>
<li>Execute pre-run tasks.</li>
<li>Inject the input generators into the environment.</li>
<li>Execute the trigger.</li>
<li>Observe the responses captured in the environment and verify them against expectations.</li>
<li>Execute post-run tasks.</li>
<li>Report the results.</li>
</ol>
<h2 id="advanced-topics">Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permanent link">&para;</a></h2>
<h3 id="expressions">Expressions<a class="headerlink" href="#expressions" title="Permanent link">&para;</a></h3>
<p>The framework provides an embedded functional programming language
that enables flexible matchers and more complex test data manipulation:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">  </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">ExpressionsExample</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">{</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">boost</span><span class="o">::</span><span class="n">json</span><span class="o">::</span><span class="n">value</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Expressions example&quot;</span><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">42</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w">                             </span><span class="p">)</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">42</span><span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w">     </span><span class="cm">(1)    </span><span class="w">                     </span><span class="p">)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span><span class="w">           </span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="o">|</span><span class="mi">3</span><span class="w"> </span><span class="cm">(2)    </span><span class="w">                     </span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Expect structure size equal 3&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">(3)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span><span class="w">           </span><span class="p">,</span><span class="w"> </span><span class="n">Saturate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ne</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">Ge</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="cm">(4)    </span><span class="w">  </span><span class="p">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">}</span><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="n">Fold</span><span class="p">(</span><span class="n">Add</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Size</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Div</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="c1">(5)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Div</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Approx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">                          </span><span class="p">)</span><span class="w"> </span><span class="c1">(6)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="n">Pi</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="n">Div</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="n">Approx</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.14159265359</span><span class="p">)</span><span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="c1">(7)</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;5:1:-1&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Arange</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span><span class="w">                          </span><span class="p">)</span><span class="w"> </span><span class="c1">(8)</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="p">}</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li><code>Eq</code> may be omitted in the context of predicate.</li>
<li>Expression composition with pipe operator. Equivalent to <code>Pipe(Size, Eq(3))</code>.</li>
<li>Optional comment.</li>
<li>Saturate the matchers over sequence input in given order.</li>
<li>Ampersand operator packs evaluation into array as <code>f &amp; g ↦ x ↦ [f(x), g(x)]</code>.
    Output is processed as <code>(((Reduce(Add) &amp; Size) | Div) | Eq(2.5))</code>
    in the following steps:<ol>
<li><code>Reduce(Add) &amp; Size</code> on input <code>[1,2,3,4]</code> produces [10, 4]</li>
<li><code>Div</code> on input <code>[10, 4]</code> produces [2.5]</li>
<li><code>Eq(2.5)</code> on input <code>[2.5]</code> produces <code>true</code></li>
</ol>
</li>
<li>A constant function can be used on input channel instead of literal</li>
<li>Flip expression (prefix ~) swaps the operands, which is useful for non-commutative transforms</li>
<li><code>Arange</code> is a generator similar to
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.arange.html">numpy.arange</a></li>
</ol>
<p>For more detailes, see <a href="../expressions/">Expression Guide</a> and <a href="../../dsl-reference/expressions/">Expression Language Reference</a>.</p>
<h3 id="input-generators">Input generators<a class="headerlink" href="#input-generators" title="Permanent link">&para;</a></h3>
<p>Inputs in SignalMapping are not limited to fixed values - they can be
dynamic generators that produce a new value on each call, created from
expressions of type <span class="arithmatex">\(\mathbb{N}^0 \mapsto JSON\)</span>, (aka <a href="https://en.wikipedia.org/wiki/Indexed_family">indexed families</a>).</p>
<p>A constant input like <code>Inject(42)</code> is just a trivial generator that ignores the index.
Generators allows to define input streams that evolve over time, for example:</p>
<ul>
<li><code>Add(1)</code> <span class="arithmatex">\(\mapsto 1, 2, 3, ...\)</span></li>
<li><code>Format("item_%d", Id)</code> <span class="arithmatex">\(\mapsto\)</span> <code>"item_0", "item_1", ...</code></li>
</ul>
<p>Internally, the framework keeps track on generator counters and allocation to channels.
On each interface call, either trigger or mock, the test runner pulls values from a set of
allocated generators and compose a returning value.
In <code>Blend</code> pipes, the test condition is a unique generator shared between all pipe channels,
See <a href="#combining-channels-in-pipes">Combining channels in pipes</a> for details.</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">  </span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">InputsGenerators</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">boost</span><span class="o">::</span><span class="n">json</span><span class="o">::</span><span class="n">value</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Input generators&quot;</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">             </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">             </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span><span class="p">(</span><span class="mi">42</span><span class="cm">(1)    </span><span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">}</span><span class="w">         </span><span class="p">)</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">        </span><span class="p">(</span><span class="n">Pi</span><span class="cm">(2)    </span><span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">At</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="n">Approx</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">))</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">        </span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="cm">(3)    </span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">}</span><span class="w">         </span><span class="p">)</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">        </span><span class="p">(</span><span class="n">Lookup</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span><span class="o">|</span><span class="n">D</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">42</span><span class="p">}</span><span class="w">             </span><span class="p">)</span><span class="c1">(4)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="p">}</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li>Top level JSON literal input stands for constant, a canonical form would be <code>C(42)</code></li>
<li>Mathematical constant</li>
<li>Simple generating function</li>
<li>Lookup function with Default 42 as generator</li>
</ol>
<h4 id="order-matters">Order matters<a class="headerlink" href="#order-matters" title="Permanent link">&para;</a></h4>
<p>The input injections are evaluated in the order of their definition in a channel list,
with exception that all inline inuts evaluated before tabular inputs
(so it is recommended to group them at the beginning for clarity).</p>
<p>The injection may be overwritten fully or partially by the following injections when channels share
the same interface and selector.</p>
<p>The input evaluation order can be utilized to do some preparations before injecting more specific subsignal.
It is especially useful with dynamic structures like STL containers or variant types like boost::json::value itself.</p>
<p>E.g. having an interface with vector input,
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">};</span>
</span></code></pre></div>
we may need to initialize a non-empty input before injecting to speciic elements:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="w">    </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/0&quot;</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">0</span><span class="o">|</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/0/1&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span></code></pre></div>
<ol>
<li>Injecting to the second element will fail without the previous line, as the default vector is empty.</li>
</ol>
<h3 id="output-matchers">Output matchers<a class="headerlink" href="#output-matchers" title="Permanent link">&para;</a></h3>
<p>Output condition are <strong>matchers</strong> of type <span class="arithmatex">\(JSON \mapsto bool\)</span> (predicates).</p>
<p>In this context, any <strong>constant expression</strong> like <code>42</code> is interpreted as an equality check:
<code>Expect(42)</code> is equivalent to <code>Expect(Eq(42))</code>.</p>
<p>ZMBT provides several matcher clauses with varying behavior:</p>
<ul>
<li><code>Expect</code> records matcher failure but <strong>allows the test to continue</strong>.</li>
<li><code>Assert</code> <img alt="🚧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f6a7.svg" title=":construction:" /> triggers an <strong>immediate failure</strong>, stopping execution.</li>
</ul>
<h4 id="series-vs-atomic-samples">Series vs atomic samples<a class="headerlink" href="#series-vs-atomic-samples" title="Permanent link">&para;</a></h4>
<p>The <code>Expect</code> or <code>Assert</code> clauses provide captured sample series directly to the matcher.</p>
<p>For convenience, the output is implicitly flattened (i.e., [x] becomes x) in the following cases:</p>
<ul>
<li>The channel has a CallCount clause.</li>
<li>The channel is bound to a trigger interface and the Repeat clause is not set.</li>
</ul>
<p>This implicit flattening improves ergonomics:</p>
<p><div class="language-c++ highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">OnTrigger</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span></code></pre></div>
vs
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">OnTrigger</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="n">Each</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="mi">42</span><span class="p">)));</span>
</span></code></pre></div></p>
<p>Specifying <code>Repeat(1)</code> explicitly disables flattening on trigger channels.</p>
<h3 id="json-serialization">JSON Serialization<a class="headerlink" href="#json-serialization" title="Permanent link">&para;</a></h3>
<p>ZMBT internally operates on JSON data, using Boost.JSON as the backend.
All injected inputs, observed outputs, and expressions are evaluated in terms of JSON values.
This means that <strong>any type used in the model shall be serializable to and from JSON</strong>.
Out of the box, it works for fundamental types and STL containers,
and any user-defined types can be supported with Boost.Describe library
or by specializing <code>zmbt::reflect::custom_serialization</code> template (see <a href="../user-guide/reflection/">Reflection guide</a>).</p>
<h4 id="json-pointer">JSON Pointer<a class="headerlink" href="#json-pointer" title="Permanent link">&para;</a></h4>
<p>ZMBT supports <strong>signal path addressing</strong> using <a href="https://tools.ietf.org/html/rfc6901">JSON Pointer</a> strings.
This allows fine-grained control over which subsignals (fields or array elements) are injected or matched:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/0/foo/bar&quot;</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/1/foo/bar&quot;</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/foo/bar&quot;</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span></code></pre></div>
<p>Each path refers to a subsignal within the arguments or return value. The pointer syntax resembles Unix-style paths, with key differences:</p>
<ul>
<li><code>""</code> (empty string) means the root of the JSON structure.</li>
<li><code>"/"</code> addresses anonymous fields.</li>
<li><code>"/0"</code>, <code>"/1"</code> refer to elements in the argument tuple (index-based).</li>
</ul>
<p>Recall the default behavior:</p>
<blockquote>
<p><em>Unary function arguments resolve to path <code>"/0"</code></em>, making scalar injection and observation intuitive.</p>
</blockquote>
<h4 id="custom-types">Custom Types<a class="headerlink" href="#custom-types" title="Permanent link">&para;</a></h4>
<p>ZMBT uses Boost.JSON with Boost.Describe to serialize and access custom C++ types:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">  </span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="n">Bar</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="n">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="n">br</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="n">br</span><span class="p">},</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">};</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="n">BOOST_DESCRIBE_ENUM</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="n">BOOST_DESCRIBE_STRUCT</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="c1">(2)</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="n">ZMBT_INJECT_JSON_TAG_INVOKE</span><span class="w"> </span><span class="c1">(3)</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="p">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="n">ZMBT_DEFINE_CUSTOM_INIT</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="c1">(4)</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li><strong>Boost.Describe</strong> reflection for enum <code>Foo</code>.</li>
<li><strong>Boost.Describe</strong> struct support for <code>Bar</code> (with no base class).</li>
<li><strong>JSON serialization support</strong> via argument-dependent lookup.</li>
<li><strong>Default initialization</strong> for custom types, required for signals with deleted default constructor.</li>
</ol>
<p>Example usage:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">  </span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">UserDataTypes</span><span class="p">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="p">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">Bar</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">        </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">foo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">foo</span><span class="p">;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="p">{</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">};</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test Call&quot;</span><span class="p">)</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/0/x&quot;</span><span class="p">)</span><span class="w">   </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/1/x&quot;</span><span class="p">)</span><span class="w">   </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/0/foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/1/foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">        </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">)</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">        </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">)</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="p">}</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="cm">  </span>
</span></code></pre></div>
<p>This test validates logic involving structured inputs and enum matching via JSON field access.</p>
<h4 id="parametrized-paths">Parametrized Paths<a class="headerlink" href="#parametrized-paths" title="Permanent link">&para;</a></h4>
<p><code>Args</code> and <code>Return</code> accept <a href="#expressions">constant expressions</a>,
which are evaluated to a JSON pointer string or integer index.
This allows dynamic construction of paths based on parameters:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/%d/%s/bar&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Fmt</span><span class="p">(</span><span class="n">Index</span><span class="p">,</span><span class="w"> </span><span class="n">Field</span><span class="p">))</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1">// or printf-like overload:</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="s">&quot;/%d/%s/bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Index</span><span class="p">,</span><span class="w"> </span><span class="n">Field</span><span class="p">)</span>
</span></code></pre></div>
<p><code>Index</code> and <code>Field</code> can be constants or literals, as well as <a href="#parametrization">ZMBT model parameters</a>
which are resolved during test model instantiation.</p>
<h4 id="operator-overloading">Operator overloading<a class="headerlink" href="#operator-overloading" title="Permanent link">&para;</a></h4>
<p>ZMBT serialization mechanism lacks type information, and Expressions by default operate on JSON values
following a most intuitive interpretation of their type, e.g. pair of real numbers is treated
as complex <code>[real, img]</code> in arithmetic operations.</p>
<p><code>Overload</code> expression can be utilized to apply certain type-specific operators in expressions:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">Overload</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
</span></code></pre></div>
<p>The operator handler constructed from <code>type&lt;Foo&gt;</code> tag will provide to the enveloped <code>f</code>
expression all existing operators for this type. If specific type does not support certain operators,
they will be substituted with stubs that will fail in runtime without blocking compilation.</p>
<p>The <code>.As</code> clause that precedes pipe condition can be used to specify the default overload per
pipe to avoid repetition in <code>.Test</code> table. In addition to overloading, it also decorates the result
of non-boolean constant expressions by piping it to Cast expression, reducing the conversion
boilerplate in both inputs and outputs.</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">  </span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">DecorUnderlying</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="p">{</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">decor</span><span class="o">::</span><span class="n">Underlying</span><span class="p">;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Decorate int -&gt; int as Foo -&gt; Foo&quot;</span><span class="p">)</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">As</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">As</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">).</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w">              </span><span class="p">)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w">              </span><span class="p">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="n">Ne</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">)</span><span class="w">          </span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="n">Ne</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">C</span><span class="p">)</span><span class="w">          </span><span class="p">)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">),</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">))</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Equivalent test with verbose casts and overloads&quot;</span><span class="p">)</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">))</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">))</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">))</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Ne</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">))</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">        </span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">Cast</span><span class="p">(</span><span class="n">type</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Ne</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">C</span><span class="p">))</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">        </span><span class="p">(</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">            </span><span class="n">Overload</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="p">)),</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">            </span><span class="n">Eq</span><span class="p">(</span><span class="n">Overload</span><span class="p">(</span><span class="n">Underlying</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="n">Foo</span><span class="o">::</span><span class="n">A</span><span class="p">)))</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="p">}</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="cm">  </span>
</span></code></pre></div>
<p>In this example we utilize a signal decorator <code>zmbt::decor::Underlying</code>,
that maps input Foo to int before passing to trigger function. Without this cast
the test will yield an error on attempt to cast string representation of Foo:A to integer,
or on trying to evaluate <code>Foo::A | Add(Foo::B)</code> as <code>Foo::A + Foo::B</code> rather then
<code>static_cast&lt;std::underlying_t&lt;Foo&gt;(Foo::A) + static_cast&lt;std::underlying_t&lt;Foo&gt;(Foo::B)</code>.</p>
<p>Note that in the verbose example the <code>Cast(Underlying&lt;Foo&gt;)</code> cannot be replaced with
<code>Cast(type&lt;int&gt;)</code>, as the conversion is done on serialized JSON values and not on C++ types.
The <code>Cast(type&lt;Foo&gt;)</code> in this context is equivalent to <code>Uncast(Underlying&lt;Foo&gt;)</code>.</p>
<p>Any user-defined type can be used as an argument to <code>Overload</code> and <code>Cast/Uncast</code> expressions
as <code>type&lt;MyType&gt;</code> tag. If default MyType JSON serialization is not sufficient for all test conversions,
it is possible to customize it by creating a decorator class with <code>decorated_type</code> member type,
that should provide non-explicit constructor and conversion operator for <code>decorated_type</code>.</p>
<h3 id="mocks">Mocks<a class="headerlink" href="#mocks" title="Permanent link">&para;</a></h3>
<p>So far, we’ve used the same function reference for <code>OnTrigger</code> and <code>At</code> clauses.
The reason each clause accepts a function reference is that you can also attach to mock interfaces,
processing side effects the same way as trigger arguments and return values:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="o">  </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">SingletoneMock</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">set_values</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x_out</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">y_out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_values</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">                </span><span class="p">.</span><span class="n">Hook</span><span class="p">(</span><span class="n">x_out</span><span class="p">,</span><span class="w"> </span><span class="n">y_out</span><span class="p">);</span><span class="w">  </span><span class="c1">(2)</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Sut</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">        </span><span class="n">Mock</span><span class="w"> </span><span class="n">mock</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">(3)</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="nf">operator</span><span class="p">()()</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">(4)</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test with mock&quot;</span><span class="p">)</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_values</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Return</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span><span class="w"> </span><span class="c1">(5)</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_values</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span><span class="w"> </span><span class="c1">(6)</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_values</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span><span class="w">               </span><span class="p">.</span><span class="n">Return</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">        </span><span class="p">(</span><span class="nb">true</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">        </span><span class="p">(</span><span class="nb">true</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">        </span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;values discarded when set_values returns false&quot;</span><span class="p">]</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="p">}</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li>Access the <code>Environment</code> record associated with this interface</li>
<li>Reroute call arguments to the <code>Environment</code></li>
<li>A common way to inject mock into the sut is to separate mock interface and implementation,
    and link the mocked implementation to the test executable.
    For brevity we keep it simple in the present guide.
    When using dependency injection, you may also utilize inheritance-based
    mocks, as it is done in GMock.</li>
<li>In this example the trigger is a functor - an object with a single <code>operator()</code> overload.</li>
<li><code>Return()</code> clause observes the mock’s return value.
    This can be omitted - it’s the default expansion for <code>At(mock)</code> channels.</li>
<li><code>Args(index)</code> clause gives access to individual mock arguments by index.
    <code>At(mock).Args(...).Inject()</code> will handle the mutable references as outputs,
    but their incoming values are also accessible separately with <code>At(mock).Args(...).Expect()</code>.</li>
</ol>
<p>In this example, the stimuli are injected into the mock object
rather than directly into the trigger.</p>
<p>The mocking mechanism uses <code>InterfaceRecord</code>, which reroutes calls to the <code>Environment</code>
- the central test harness state accessed by the test runner.
This API works uniformly for all callables, including templates, deducing arguments and return type
from callable signature.</p>
<p>By default, the mock behaves as a singleton — all Mock instances delegate to the same record.
If a singleton mock is not sufficient and you need to differentiate
between multiple mock instances, you can pass an additional reference object to the <code>InterfaceRecord</code>.
This allows the <code>Environment</code> to distinguish calls from separate instances:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="o">  </span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">MultiInstanceMock</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">{</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_value</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_value</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">                </span><span class="p">.</span><span class="n">Hook</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ConsumeAndSubstract</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span><span class="n">Mock</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mock_x</span><span class="p">;</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">        </span><span class="n">Mock</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mock_y</span><span class="p">;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">        </span><span class="n">ConsumeAndSubstract</span><span class="p">(</span><span class="n">Mock</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mx</span><span class="p">,</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">my</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mock_x</span><span class="p">{</span><span class="n">mx</span><span class="p">},</span><span class="w"> </span><span class="n">mock_y</span><span class="p">{</span><span class="n">my</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="k">operator</span><span class="p">()()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">            </span><span class="n">mock_x</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">            </span><span class="n">mock_y</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">(2)</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">    </span><span class="n">Mock</span><span class="w"> </span><span class="n">mock_x</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="w">    </span><span class="n">Mock</span><span class="w"> </span><span class="n">mock_y</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="n">ConsumeAndSubstract</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="p">{</span><span class="n">mock_x</span><span class="p">,</span><span class="w"> </span><span class="n">mock_y</span><span class="p">};</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test with multi-instance mock&quot;</span><span class="p">)</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_value</span><span class="p">,</span><span class="w"> </span><span class="n">mock_x</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">set_value</span><span class="p">,</span><span class="w"> </span><span class="n">mock_y</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Args</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">        </span><span class="p">(</span><span class="mi">-2</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-4</span><span class="p">)</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="p">}</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li>The <code>this</code> pointer is used as a reference object here, but it can be any
    <code>void*</code> pointer - it simply serves as an identifier to find the interface
    record in the <code>Environment</code>. The default reference object is <code>nullptr</code>.</li>
<li>Using non-commutative op here to demonstrate the mock instance tracing.</li>
</ol>
<p>Example of using string key instead of this pointer to reference the mock instance in test:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="o">  </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">MockReferencingByString</span><span class="p">)</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">id_</span><span class="p">;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="n">Mock</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id_</span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">id_</span><span class="p">).</span><span class="n">Hook</span><span class="p">();</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">SUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]{</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">        </span><span class="n">Mock</span><span class="p">(</span><span class="s">&quot;lol&quot;</span><span class="p">).</span><span class="n">foo</span><span class="p">();</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">        </span><span class="n">Mock</span><span class="p">(</span><span class="s">&quot;kek&quot;</span><span class="p">).</span><span class="n">foo</span><span class="p">();</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test interface associated with string&quot;</span><span class="p">)</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">SUT</span><span class="p">)</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lol&quot;</span><span class="p">).</span><span class="n">CallCount</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kek&quot;</span><span class="p">).</span><span class="n">CallCount</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="p">}</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="cm">  </span>
</span></code></pre></div>
<h3 id="parametrization">Parametrization<a class="headerlink" href="#parametrization" title="Permanent link">&para;</a></h3>
<p>The previous examples used invariant test models with all components and condition values hardcoded.
The example below demonstrates how to define parametrized test models for greater flexibility and reusability:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="o">  </span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">ZipParametrization</span><span class="p">)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="p">{</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">log</span><span class="p">).</span><span class="n">Hook</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Sut</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">        </span><span class="n">Mock</span><span class="w"> </span><span class="n">mock</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::bar&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">baz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::baz&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Sut</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="n">Param</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Method</span><span class="w">  </span><span class="p">{</span><span class="s">&quot;test interface&quot;</span><span class="p">};</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="n">Param</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;interface name&quot;</span><span class="p">};</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test with zip params on %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="cm">(2)    </span><span class="p">)</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="n">sut</span><span class="p">)</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">log</span><span class="p">)</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">            </span><span class="p">.</span><span class="n">Take</span><span class="p">(</span><span class="n">Last</span><span class="p">)</span><span class="w"> </span><span class="c1">// 3</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">            </span><span class="p">.</span><span class="n">Expect</span><span class="p">(</span><span class="n">All</span><span class="p">(</span><span class="n">Contains</span><span class="p">(</span><span class="n">Name</span><span class="cm">(4)    </span><span class="p">),</span><span class="w"> </span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;Sut&quot;</span><span class="p">)))</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">    </span><span class="p">.</span><span class="n">Zip</span><span class="w"> </span><span class="c1">(5)</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">        </span><span class="p">(</span><span class="n">Name</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::baz&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">(6)</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">        </span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">foo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">bar</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">baz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">(7)</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">    </span><span class="p">.</span><span class="n">Description</span><span class="p">(</span><span class="s">&quot;Method: %s, Name: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">)</span><span class="w"> </span><span class="c1">(8)</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="p">}</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="cm">  </span>
</span></code></pre></div>
<ol>
<li><code>Param</code> is a placeholder object with string or int identifier.
    It must be unique within the test model. These identifiers are also
    used for diagnostics and reporting, so meaningful names are encouraged.</li>
<li>Strings can be parametrized as expressions, deferring the string formatting.</li>
<li>Extracting captured value from series, as mock outputs are not flattened by default.</li>
<li>Parameters can be nested deep in the expressions.</li>
<li>Use <code>Zip</code> or <code>Pro</code> to generate multiple test instances with different parameter combinations.</li>
<li>Each parameter list follows the syntax: <span class="arithmatex">\((key, x_1, x_2, ..., x_n)\)</span>.</li>
<li>Any model element can be parametrized - including member function pointers.</li>
<li>An optional test description clause.</li>
</ol>
<p>In this example, the <code>Zip</code> clause introduces model parametrization.
Like <code>Test</code>, it initiates a list of parameters in an <code>operator()</code>
cascade. Each row in this table begins with a parameter key (created with
<code>Param</code>), followed by corresponding values.</p>
<p>Before the model runner comes into play, the model resolver
transforms such a definition into a series of invariant instances,
resulting in three tests in this case.</p>
<p>Another feature in this example is a channel parameters deduction
- we can omit <code>Args(0)</code> and <code>Return()</code> clauses, as they are expanded
by model resolver from the interface by the following rule:</p>
<ul>
<li><em>on trigger</em>: inject to args and observe on return,</li>
<li><em>on mock</em>: inject to return and observe on args,</li>
<li><em>unary function args</em> resolves to value, the rest
     resolve to the arguments tuple (more on this later).</li>
</ul>
<p>The <code>Zip</code> clause requires all parameter lists to be of equal length or
containing a single element which intended to be repeated with other parameters:</p>
<p><div class="language-cpp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span></code></pre></div>
This clause yields <code>(1,1,4), (2,2,4), (3,3,4)</code>, but the following one will fail
at runtime due to inconsistent zip parameters count:
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span></code></pre></div></p>
<p>You can also repeat the same parameter key in multiple rows to avoid super-wide tables
like this:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span></code></pre></div>
<p>which is equivalent to</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span></code></pre></div>
<p>The order of parameter keys doesn't matter, and you may notice that parameters
table oriented horizontally, i. e. <em>row -&gt; parameter</em>, unlike the test matrix,
which is <em>column -&gt; channel</em>.</p>
<p>Another parametrization clause is <code>Prod</code>, which stands for <em>Cartesian product</em>,
s.t.
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">.</span><span class="n">Prod</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
</span></code></pre></div>
yields a set of 4 model instances with <em>X, Y</em> equals
<code>(1, 10), (1, 20), (2, 10), (20, 20)</code> correspondingly.</p>
<p>Parameter clauses can be used multiple times - each clause creates an independent group.
<code>Prod</code> and <code>Zip</code> clauses also can be chained</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="p">.</span><span class="n">Prod</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w">  </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">.</span><span class="n">Prod</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w">  </span><span class="mi">3</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span>
</span></code></pre></div>
<p>Here each clause initiates a separate product or zip set, resulting in
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>(1, 10), (1, 20), (2, 30), (2, 40), (3, 50), (3, 60), (4, 50), (4, 60)
</span></code></pre></div></p>
<h4 id="registering-non-serializable-components">Registering non-serializable components<a class="headerlink" href="#registering-non-serializable-components" title="Permanent link">&para;</a></h4>
<p>Any non-serializable model component may be registered in the <code>Environment</code> and
referenced by a string key. This is what actually happens under the hood when we
placed mfp literals in zip parameters in one of the examples above:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="p">(</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">foo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">bar</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">baz</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="p">(</span><span class="n">Name</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::baz&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>We can do that registration explicitly:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="o">  </span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">UsingRegistry</span><span class="p">)</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">log</span><span class="p">).</span><span class="n">Hook</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Sut</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">        </span><span class="n">Mock</span><span class="w"> </span><span class="n">mock</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::bar&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">baz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Sut::baz&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Sut</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">    </span><span class="n">Environment</span><span class="w"> </span><span class="n">env</span><span class="p">{};</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">    </span><span class="n">env</span><span class="p">.</span><span class="n">RegisterTrigger</span><span class="p">(</span><span class="s">&quot;Sut::foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">sut</span><span class="p">);</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="w">    </span><span class="n">env</span><span class="p">.</span><span class="n">RegisterTrigger</span><span class="p">(</span><span class="s">&quot;Sut::bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">bar</span><span class="p">,</span><span class="w"> </span><span class="n">sut</span><span class="p">);</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="w">    </span><span class="n">env</span><span class="p">.</span><span class="n">RegisterTrigger</span><span class="p">(</span><span class="s">&quot;Sut::baz&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Sut</span><span class="o">::</span><span class="n">baz</span><span class="p">,</span><span class="w"> </span><span class="n">sut</span><span class="p">);</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="w">    </span><span class="n">env</span><span class="p">.</span><span class="n">RegisterInterface</span><span class="p">(</span><span class="s">&quot;Mock::log&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">log</span><span class="p">);</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="w">    </span><span class="n">Param</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;interface method&quot;</span><span class="p">};</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test with zip params on %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">Method</span><span class="p">)</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="s">&quot;Mock::log&quot;</span><span class="p">)</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="w">            </span><span class="p">.</span><span class="n">Expect</span><span class="p">(</span><span class="n">Eq</span><span class="p">({</span><span class="n">Method</span><span class="p">}))</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="w">    </span><span class="p">.</span><span class="n">Zip</span><span class="p">(</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sut::baz&quot;</span><span class="p">)</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="p">}</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="cm">  </span>
</span></code></pre></div>
<p>In the same way tasks and operators may be registered and referenced by key.</p>
<p>Benefits from this approach are:</p>
<ul>
<li>meaningful interface names in test report.</li>
<li>enabled deferred string formatting for interfaces.</li>
<li>reuse string parameters in different roles (like <code>Method</code> in the example)</li>
</ul>
<h3 id="combining-channels-in-pipes">Combining channels in pipes<a class="headerlink" href="#combining-channels-in-pipes" title="Permanent link">&para;</a></h3>
<p>When testing the relationship between different channels, it may be necessary to apply a single condition on them.
It can be made with clauses like <code>Group</code> or <code>Blend</code>, placed in place of terminal <code>Inject</code> or <code>Expect</code> clauses.
Channels separated by such clauses will be combined in a single <em>condition pipe</em>.</p>
<p>Input pipes will reuse generator, and output pipes will compose observed samples into a single structure
as following:</p>
<table>
<thead>
<tr>
<th></th>
<th>Group</th>
<th>Blend</th>
</tr>
</thead>
<tbody>
<tr>
<td>Input</td>
<td>Copy generator for each channel</td>
<td>Share single generator between channels</td>
</tr>
<tr>
<td>Output</td>
<td>Pack samples into a tuple</td>
<td>Merge samples into a series of <code>[id, sample]</code></td>
</tr>
</tbody>
</table>
<p>For piped outputs, the test runner will combine the captured samples from the chained channels according to certain rules.
The result is passed then to the matcher expression specified at <code>Expect</code> clause argument or on the corresponding test matrix column.</p>
<p>Input <code>Group</code> pipe simply reduces repetition by reusing the same condition for different channels,
while keeping their evaluation independent.</p>
<p>Input <code>Blend</code> pipe will share the same generator instance, and the difference with <code>Group</code> will be
visible on non-constant generators.</p>
<p>The output <code>Blend</code> pipr merges captured samples in a time series, producing a list of pairs <code>[id, signal]</code>, sorted by timestamp.
Id field, if not defined explicitly with <code>Alias</code> clause, is a channel absolute index (ignoring the pipe boundaries).</p>
<p>In combination with <code>Saturate</code> or other custom matchers, the <code>Blend</code> output can be utilized for testing a strict or partial order on mock calls.</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="o">  </span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">TestMultichannelPipes</span><span class="p">)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="p">{</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">repack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">){</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">boost</span><span class="o">::</span><span class="n">json</span><span class="o">::</span><span class="n">object</span><span class="p">{</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">},</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">},</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">},</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test Group on input&quot;</span><span class="p">)</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/a&quot;</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/b&quot;</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/c&quot;</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="n">Each</span><span class="p">(</span><span class="mi">42</span><span class="o">|</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test Blend on input&quot;</span><span class="p">)</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">Blend</span><span class="p">()</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Blend</span><span class="p">()</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Args</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/a&quot;</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/b&quot;</span><span class="p">).</span><span class="n">Group</span><span class="p">()</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">repack</span><span class="p">).</span><span class="n">Return</span><span class="p">(</span><span class="s">&quot;/c&quot;</span><span class="p">).</span><span class="n">Expect</span><span class="p">({{</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">},{</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">}})</span>
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">foo</span><span class="p">).</span><span class="n">Hook</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">bar</span><span class="p">).</span><span class="n">Hook</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">mock</span><span class="p">;</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">flip</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-32-46"><a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">{};</span>
</span><span id="__span-32-47"><a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>
</span><span id="__span-32-48"><a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span>
</span><span id="__span-32-49"><a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">flip</span><span class="p">)</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">foo</span><span class="p">(</span><span class="n">count</span><span class="o">++</span><span class="p">);</span>
</span><span id="__span-32-50"><a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">mock</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">count</span><span class="o">++</span><span class="p">);</span>
</span><span id="__span-32-51"><a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-32-52"><a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a>
</span><span id="__span-32-53"><a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a><span class="w">    </span><span class="n">Param</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span><span class="p">{</span><span class="s">&quot;N&quot;</span><span class="p">};</span>
</span><span id="__span-32-54"><a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a><span class="w">    </span><span class="n">Param</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Match</span><span class="p">{</span><span class="s">&quot;Match&quot;</span><span class="p">};</span>
</span><span id="__span-32-55"><a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>
</span><span id="__span-32-56"><a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test Blend on output&quot;</span><span class="p">)</span>
</span><span id="__span-32-57"><a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">SUT</span><span class="p">).</span><span class="n">Repeat</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</span><span id="__span-32-58"><a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">SUT</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-32-59"><a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">foo</span><span class="p">).</span><span class="n">Alias</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">).</span><span class="n">Blend</span><span class="p">()</span>
</span><span id="__span-32-60"><a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">bar</span><span class="p">).</span><span class="n">Alias</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="n">Match</span><span class="p">)</span>
</span><span id="__span-32-61"><a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a><span class="w">    </span><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-32-62"><a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a><span class="w">        </span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w">  </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-32-63"><a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a><span class="w">        </span><span class="p">(</span><span class="n">Match</span><span class="p">,</span><span class="w"> </span><span class="n">Serialize</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span><span class="s">[[&quot;f&quot;,0],[&quot;b&quot;,1]]</span><span class="dl">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-32-64"><a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a><span class="w">    </span><span class="p">.</span><span class="n">Zip</span>
</span><span id="__span-32-65"><a id="__codelineno-32-65" name="__codelineno-32-65" href="#__codelineno-32-65"></a><span class="w">        </span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-32-66"><a id="__codelineno-32-66" name="__codelineno-32-66" href="#__codelineno-32-66"></a><span class="w">        </span><span class="p">(</span><span class="n">Match</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="p">(</span><span class="n">At</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">All</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">)</span><span class="o">|</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span><span class="o">|</span><span class="mi">21</span><span class="p">))</span>
</span><span id="__span-32-67"><a id="__codelineno-32-67" name="__codelineno-32-67" href="#__codelineno-32-67"></a><span class="w">        </span><span class="p">(</span><span class="n">Match</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="p">(</span><span class="n">At</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Slide</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Map</span><span class="p">(</span><span class="n">Sub</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">41</span><span class="p">)</span>
</span><span id="__span-32-68"><a id="__codelineno-32-68" name="__codelineno-32-68" href="#__codelineno-32-68"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-32-69"><a id="__codelineno-32-69" name="__codelineno-32-69" href="#__codelineno-32-69"></a><span class="p">}</span>
</span><span id="__span-32-70"><a id="__codelineno-32-70" name="__codelineno-32-70" href="#__codelineno-32-70"></a><span class="cm">  </span>
</span></code></pre></div>
<p class="annotate">As it is stated previously, the list of non-fixed pipes acts as a table header for the test matrix (1).</p>
<ol>
<li>Defined with the <code>Test</code> clause</li>
</ol>
<h3 id="multithreading">Multithreading<a class="headerlink" href="#multithreading" title="Permanent link">&para;</a></h3>
<p>ZMBT mocks implemented with <code>InterfaceRecord(...).Hook(...)</code> calls
are thread safe:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="o">  </span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">TestMultithreading</span><span class="p">)</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">produce</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">).</span><span class="n">Hook</span><span class="p">();</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">consume</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">).</span><span class="n">Hook</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">producer</span><span class="p">,</span><span class="w"> </span><span class="n">consumer</span><span class="p">;</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">producer</span><span class="p">.</span><span class="n">produce</span><span class="p">();</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="mi">1</span><span class="n">ms</span><span class="p">);</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">            </span><span class="n">consumer</span><span class="p">.</span><span class="n">consume</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">{</span><span class="mi">8</span><span class="p">};</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">threads</span><span class="p">;</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">threads</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="kr">thread</span><span class="o">:</span><span class="w"> </span><span class="n">threads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">            </span><span class="kr">thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test SUT with multithreading&quot;</span><span class="p">)</span>
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">SUT</span><span class="p">)</span>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">produce</span><span class="p">,</span><span class="w"> </span><span class="n">producer</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="o">~</span><span class="n">Sub</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span><span class="w"> </span><span class="c1">// xi = 42 - i</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">consume</span><span class="p">,</span><span class="w"> </span><span class="n">consumer</span><span class="p">).</span><span class="n">Take</span><span class="p">(</span><span class="n">Max</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">consume</span><span class="p">,</span><span class="w"> </span><span class="n">consumer</span><span class="p">).</span><span class="n">CallCount</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">consume</span><span class="p">,</span><span class="w"> </span><span class="n">consumer</span><span class="p">).</span><span class="n">ThreadId</span><span class="p">().</span><span class="n">Expect</span><span class="p">(</span><span class="n">Card</span><span class="o">|</span><span class="mi">8</span><span class="p">)</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="p">}</span>
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="cm">  </span>
</span></code></pre></div>
<h3 id="fixture-tasks">Fixture tasks<a class="headerlink" href="#fixture-tasks" title="Permanent link">&para;</a></h3>
<p>The signal mapping models are tested in a presumably clean environment, which
mean that you can't affect the model execution from outside by injecting some
values to the mocks - the test runner will clean the environment test data
before each test case. In many cases we may need some preparation or cleanup
to be done outside the test, a typical task for the test fixture.
This can be done with <code>PreRun</code> and <code>PostRun</code> methods, that takes a list of tasks:</p>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="o">  </span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">FixtureTasks</span><span class="p">)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="p">{</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="nf">get_value</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">get_value</span><span class="p">).</span><span class="n">Hook</span><span class="p">();</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Mock</span><span class="p">().</span><span class="n">get_value</span><span class="p">();</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;Test pre- and post-run tasks&quot;</span><span class="p">)</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">get_value</span><span class="p">).</span><span class="n">Inject</span><span class="p">()</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">sut</span><span class="p">)</span><span class="w">             </span><span class="p">.</span><span class="n">Expect</span><span class="p">()</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">    </span><span class="p">.</span><span class="n">Test</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">        </span><span class="p">(</span><span class="mi">13</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">)</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">        </span><span class="p">(</span><span class="n">Noop</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">    </span><span class="p">.</span><span class="n">PreRun</span><span class="p">([]{</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">        </span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">get_value</span><span class="p">).</span><span class="n">InjectReturn</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">    </span><span class="p">.</span><span class="n">PostRun</span><span class="p">([]{</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">        </span><span class="n">BOOST_CHECK_EQUAL</span><span class="p">(</span><span class="n">InterfaceRecord</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Mock</span><span class="o">::</span><span class="n">get_value</span><span class="p">).</span><span class="n">ObservedCalls</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="p">}</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="cm">  </span>
</span></code></pre></div>
<p>The pre-run task will reset the stimulus to 42 before each test.
On the first test case, this stimulus is overwritten by the value from the
test vector, but in the second case, <code>Noop</code> tells the runner to skip injection.</p>
<p>The order of <code>InjectReturn</code> or <code>InjectArgs</code> calls on <code>InterfaceRecord</code> has the same effect as order
of injections on channel clauses (see <a href="#order-matters">Order matters</a>).
For such a such simple logic as in the given example it is recommended to use <a href="#inline-conditions">inline conditions</a>
instead, but the tasks can be useful in handling side-effects not accessible in Expressions,
like SUT reset or extra logging.</p>
<h3 id="diagnostic-output">Diagnostic output<a class="headerlink" href="#diagnostic-output" title="Permanent link">&para;</a></h3>
<p>Consider the following example:
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="o">  </span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="n">ExpressionDiagnostics</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">utf</span><span class="o">::</span><span class="n">disabled</span><span class="p">())</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">{</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">boost</span><span class="o">::</span><span class="n">json</span><span class="o">::</span><span class="n">value</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="n">SignalMapping</span><span class="p">(</span><span class="s">&quot;SignalMapping test&quot;</span><span class="p">)</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="p">.</span><span class="n">OnTrigger</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Inject</span><span class="p">(</span><span class="s">&quot;1:5&quot;</span><span class="o">|</span><span class="n">Arange</span><span class="p">)</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">        </span><span class="p">.</span><span class="n">At</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">Expect</span><span class="p">(</span><span class="n">Reduce</span><span class="p">(</span><span class="n">Add</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Size</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Div</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eq</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Not</span><span class="p">)</span><span class="w"> </span><span class="c1">(1)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="p">;</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="p">}</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="cm">  </span>
</span></code></pre></div></p>
<ol>
<li>Naive average computation - use Avg instead for real tasks.</li>
</ol>
<p>Negation at the matcher end lead to test failure, and the log message is following:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ZMBT FAIL</span><span class="p">:</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SignalMapping</span><span class="nv"> </span><span class="s">test&quot;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;expectation</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">failed&quot;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">      </span><span class="nt">expected</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(Fold(Add) &amp; Size) | Div | Eq(2.5E0) | Not</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">      </span><span class="nt">observed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="nv">4</span><span class="p p-Indicator">]</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&quot;pipe&quot;</span><span class="p p-Indicator">:</span><span class="nv">1</span><span class="p p-Indicator">}</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">      </span><span class="nt">expression eval stack</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">        </span><span class="no">---</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">                 </span><span class="no">┌── Add $ [1,2] = 3</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">                 </span><span class="no">├── Add $ [3,3] = 6</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">                 </span><span class="no">├── Add $ [6,4] = 10</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">              </span><span class="no">┌── Fold(Add) $ [1,2,3,4] = 10</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">              </span><span class="no">├── Size $ [1,2,3,4] = 4</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">           </span><span class="no">┌── Fold(Add) &amp; Size $ [1,2,3,4] = [10,4]</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">           </span><span class="no">├── Div $ [10,4] = 2.5E0</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">           </span><span class="no">├── Eq(2.5E0) $ 2.5E0 = true</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">           </span><span class="no">├── Not $ true = false</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">        </span><span class="no">□  (Fold(Add) &amp; Size) | Div | Eq(2.5E0) | Not $ [1,2,3,4] = false</span>
</span></code></pre></div>
<p>To enable pretty-printing for JSON items, pass <code>--zmbt_log_prettify</code> command line argument.</p>
<p>  </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../.." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../expressions/" class="md-footer__link md-footer__link--next" aria-label="Next: Expressions">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Expressions
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022-2023 Volvo Car Corporation //
Copyright &copy; 2024-2025 Zenseact AB
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.select", "content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../docs/javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../assets/mkdocs_puml/puml.js"></script>
      
        <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
      
        <script src="../../assets/mkdocs_puml/interaction.js"></script>
      
    
  </body>
</html>